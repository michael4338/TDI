完成版，代码风格也已修改